if [ -n "$PROFILE_LOADED" ]; then
  return
fi
export PROFILE_LOADED=1

export DOTFILES_ROOT="$HOME/.dotfiles"
export EDITOR="nvim"

export GTK_THEME=Flat-Remix-GTK-Blue-Darkest
export QT_QPA_PLATFORMTHEME=qt5ct

export TORCH_HOME="$HOME/.torch-home"
export NODE_PATH="$HOME/.local/lib/node_modules:$NODE_PATH"
export GRIM_DEFAULT_DIR=/tmp/0-screenshots
export GTAGSLABEL=pygments

# Android PATH
ANDROID_SDK_ROOT="/opt/studio-android-sdk"
if [ -d "$ANDROID_SDK_ROOT" ]; then
  export ANDROID_SDK_ROOT
  export ANDROID_HOME="$ANDROID_SDK_ROOT"

  ANDROID_NDK_ROOT=$(find "$ANDROID_SDK_ROOT/ndk" -mindepth 1 -maxdepth 1 \
    \( -type d -o -type l \) \
    -regextype posix-extended -regex ".*/[0-9]+(\.[0-9]+)*" |
    sort -V | tail -n1)
  if [ -d "$ANDROID_NDK_ROOT" ]; then
    export ANDROID_NDK_ROOT
    export ANDROID_NDK_HOME="$ANDROID_NDK_ROOT"
  fi

  ANDROID_PATHS=(
    "$ANDROID_SDK_ROOT/tools"
    "$ANDROID_SDK_ROOT/tools/bin"
    "$ANDROID_SDK_ROOT/platform-tools"
    "$ANDROID_SDK_ROOT/emulator"
  )
  ANDROID_PATH=$(IFS=:; echo "${ANDROID_PATHS[*]}")
  export PATH="$ANDROID_PATH:$PATH"
  unset ANDROID_PATH
  unset ANDROID_PATHS
fi

export PATH="$HOME/.local/bin:$HOME/.cargo/bin:$DOTFILES_ROOT/dotfiles/scripts:$HOME/Code/scripts:$PATH"

# SSH Agent
if [ -n "$XDG_RUNTIME_DIR" ]; then
  SSH_AGENT_ENV_PATH="${XDG_RUNTIME_DIR}/ssh-agent-${USER}.env"
else
  SSH_AGENT_ENV_PATH="/tmp/ssh-agent-${USER}.env"
fi

if ! pgrep -u "$USER" ssh-agent > /dev/null; then
  ssh-agent > "$SSH_AGENT_ENV_PATH"
  chmod 600 "$SSH_AGENT_ENV_PATH"
fi
if [ -z "$SSH_AUTH_SOCK" ]; then
  source "$SSH_AGENT_ENV_PATH" > /dev/null
fi

# Cache tmpfs directories
if [ ! -z "$XDG_RUNTIME_DIR" ]; then
  mkdir -p "$XDG_RUNTIME_DIR"/cache/doublecmd
  mkdir -p "$XDG_RUNTIME_DIR"/cache/gimp
  mkdir -p "$XDG_RUNTIME_DIR"/cache/mozilla
  mkdir -p "$XDG_RUNTIME_DIR"/cache/nvim
  mkdir -p "$XDG_RUNTIME_DIR"/cache/thumbnails
  mkdir -p "$XDG_RUNTIME_DIR"/cache/ueberzugpp
  mkdir -p "$XDG_RUNTIME_DIR"/cache/pikaur/build
  mkdir -p "$XDG_RUNTIME_DIR"/cache/firefox-mpris
  mkdir -p "$XDG_RUNTIME_DIR"/cache/Temp
fi

mkdir -p /tmp/1-imgs $GRIM_DEFAULT_DIR

source "$HOME/.zsh_dotfiles_settings"
[[ -f "$HOME/.profile_local" ]] && source "$HOME/.profile_local"
